
## 마운트
파일 시스템이 디렉터리 계층 구조와 연결되어 있지 않으면 사용자가 해당 파일 시스템에 접근할 수 없다. 파일 시스템을 디렉터리 계층 구조의 특정 디렉터리와 연결하는 것을 `마운트`라고 한다. 파일 시스템이 연결되는 디렉터리를 `마운트 포인트`라고 하고, 파일 시스템을 부팅마다 자동으로 마운트되도록 하려면 `/etc/fstab` 파일에 설정을 추가한다.

`/etc/fstab` 파일은 파일 시스템의 마운트 설정 정보를 가지고 있는 파일이다. 리눅스 시스템은 부팅할 때 이 파일을 읽고 설정 내용에 따라 `파일 시스템을 자동으로 마운트`한다. 만약 이 파일에 오류가 있으면 시스템 부팅이 중지될 수 있다.

### /etc/fstab 구조

![](images/linux/fstab.png)
- 장치명
- 마운트 포인트
- 파일 시스템 종류
- 옵션
- 덤프 관련 설정
- 파일 점검 옵션

두번째 행의 장치명이 UUID로 시작한다. 이는 만일 디스크가 추가될 때 `부트 로더`를 가지고 있는 부트 장치의 이름이 바뀌는 것을 방지하기 위해 사용된다. 

**UUID: 시스템에서 유일하게 구분되어지는 128비트의 숫자**

---

## 마운트 관련 명령

### mount
- mount \[옵션\] \[장치명\] \[마운트 포인트\]
- 옵션
	- -t 파일 시스템 종류: 파일 시스템 종류를 지정
	- -o 마운트 옵션: 마운트 옵션을 지정
	- -f: 마운트를 할 수 있는지 점검
	- -r: 읽기만 가능하게 마운트 (= -o ro)
- 사용 예
	- mount: 현재 마운트되어 있는 정보 출력 (= `/etc/mtab` 파일 내용 출력)
	- mount /dev/sdb1 /
	- mount -t iso9660 /dev/cdrom /mnt/cdrom

### umount
- umount \[옵션\] \[장치명 또는 마운트 포인트\]
- 옵션
	- -t 파일 시스템 종류: 파일 시스템 종류 지정
- 사용 예
	- umount /dev/sdb1 (장치명)
	- umount /mnt (마운트 포인트)

---
## 디스크 추가 설치
IDE, SATA, SCSI, NVMe는 디스크 같은 장치를 연결하는 인터페이스.
디스크를 추가하는 단계는 다음과 같다.
1. 새 디스크 장착
2. 디스크 파티션 나누기 (fdisk)
3. 파티션마다 파일 시스템 생성 (= 포맷)
4. 디스크 마운트 (mount)

### 디스크 파티션 분할
하나의 디스크를 독립된 영역으로 구분하는 것으로, 디스크 장치명 뒤에 숫자를 붙여서 구분한다. 디스크를 파티션으로 나누는 작업은 `fdisk` 명령을 통해 수행할 수 있다.
- fdisk \[옵션\] \[장치명\]
- 옵션
	- -b 크기: 섹터 크기 지정 (512, 1024, 2048, 4096..)
	- -l: 파티션 테이블 출력
- 사용 예
	- fdisk -l
	- fdisk /dev/sdb
- 내부 명령
	- a: 부팅 파티션 설정
	- p: 파티션 테이블 출력
	- d: 파티션 삭제
	- l: 파티션 목록 출력 (83: Linux, 8e: Linux LVM)
	- n: 새로운 파티션 추가
	- w: 파티션 정보를 디스크에 저장하고 종료
	- q: 작업을 저장하지 않고 종료


### 파일 시스템 생성
파티션 작업이 끝나면 파티션에 파일 시스템을 생성해야 한다. 리눅스에서 파일 시스템을 만들 때 사용하는 명령은 `mkfs`와 `mke2fs`가 있다. 이 명령은 `/sbin` 디렉터리에 존재한다.

#### mkfs
- mkfs \[옵션\] \[장치명\]
- 옵션
	- -t 종류: 파일 시스템 종류 지정 (기본값 ext2)
- 사용 예
	- mkfs /dev/sdb1
	- mkfs -t ext4 /dev/sdb2
	- mkfs.ext3 /dev/sdb3

#### mke2fs
- `/etc/mke2fs.conf` 설정 파일에 파일 시스템의 종류에 따라 기본값 정의되어 있음
- mke2fs \[옵션\] \[장치명\]
- 옵션
	- -t 종류
	- -b 블록 크기: 블록 크기를 바이트 수로 지정
	- -c: 배드 블록 체크
	- -f 프래그먼트 크기: 프래그먼트 크기를 바이트 수로 지정
	- -i inode당 바이트 수: inode당 바이트 수 지정 (기본값 4K)
- 사용 예
	- mke2fs /dev/sdb1
	- mke2fs -t ext4 -b 4096 /dev/sdb2

파티션에 파일 시스템을 생성한 뒤(= 포맷 작업)에는 `mount` 명령어를 통해 디렉터리 계층 구조에 연결해야 사용자가 접근할 수 있다. 

---
## LVM

### Logical Volume Manager
여러 개의 디스크를 하나의 디스크처럼 사용하거나, 한 파티션의 용량이 부족할 때 다른 파티션으로 연장하여 사용하는 등 파티션을 효율적으로 사용할 수 있도록 해주는 관리 도구

![](images/linux/lvm.png)

- PV(Physical Volume): 실제 하드디스크의 파티션
- PE(Physical Extent): PV가 가진 일정한 블록
- VG(Volume Group): 여러개의 PV를 그룹으로 묶은 그룹
- LV(Logical Volume): VG를 다시 적절한 크기의 파티션으로 나눈 볼륨
- LE(Logical Extent): LE가 가진 일정한 블록

PV로 초기화된 파티션은 일정한 PE로 구성된다. PV 여러 개를 묶어 VG를 구성하고, VG를 다시 원하는 크기와 개수로 분할한다. 분할된 볼륨을 LV라 하고, PE는 LV의 LE와 1:1로 매핑된다.

### LVM 생성 과정
1. 기존 파일 시스템 종류 변경: 83(Linux) -> 8e(Linux LVM) (`fdisk 내부 명령 t`)
2. PV 생성 (pvcreate)
3. VG 생성 (vgcreate)
4. VG 활성화 (vgchange -a y)
5. LV 생성 (lvcreate)
6. LV에 파일 시스템 생성 (mkfs, mke2fs)
7. LV 마운트 (mount)

```shell
fdisk /dev/nvme0n1  ->  내부 명령 t로 파일 시스템 종류 8e로 변경

pvcreate 파티션 이름 -> PV 생성
pvscan -> PV 상태 확인

vgcreate VG명 PV명1 PV명2 ... -> VG 생성
vgchange -a n VG명 -> VG 비활성화
vgchange -a y VG명 -> VG 활성화
vgremove VG명 -> VG 삭제
vgextend VG명 PV명 -> VG에 PV 추가
vgreduce VG명 PV명 -> VG에 PV 삭제
vgdisplay -v VG명 -> VG 정보 확인 (PE 개수)

lvcreate -l [PE 개수] VG명 -n LV명 -> LV 생성
lvscan -> LV 정보 확인
```

---

## 디스크 관리
디스크 사용량을 점검하는 명령으로는 파일 시스템별로 전체 사용량을 확인하는 `df` 명령과 디렉터리별로 디스크 사용량을 확인하는 `du` 명령이 있다.

#### df
- 'disk free'의 약자로 현재 시스템에서 사용 중인 파일 시스템의 사용량에 대한 정보 출력
- df \[옵션\] \[파일 시스템\]
- 옵션
	- -a: 모든 파일 시스템 대상
	- -k: 디스크 사용량을 KB 단위로 출력
	- -m: 디스크 사용량을 MB 단위로 출력
	- -h: 디스크 사용량을 알기 쉬운 단위로 맞춰서 출력
	- -t 종류: 지정한 파일 시스템 종류에 해당하는 디스크 사용량 출력
	- -T: 파일 시스템 종류도 출력

#### du
- 디스크의 사용 공간에 대한 정보 출력
- du \[옵션\] \[디렉터리\]
- 옵션
	- -s: 특정 디렉터리의 전체 사용량 출력
	- -h: 디스크 사용량을 알기 쉬운 단위로 출력
- 사용 예
	- du
	- du -s ~user1