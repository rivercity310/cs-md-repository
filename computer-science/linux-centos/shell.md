
## Shell?
중재자 역할을 하는 소프트웨어로 리눅스 커널과 사용자 사이에 위치한다. 기본적으로 제공되는 배시셸은 유닉스의 전통적인 셸인 본셸(최초의 셸)과 호환성을 유지하고 사용자 편의 기능이 추가되었다.

## Shell의 기능

### 명령어 해석기 기능
사용자와 커널 사이에서 명령을 해석하여 전달하는 `Interpreter`와 `Translator` 기능
셸은 사용자가 입력한 명령이나 파일에서 읽어 들인 `명령을 해석`하고 `적절한 프로그램을 실행`한다. 명령이 셸 자체 `내장 명령`인 경우 특별한 추가 작업 없이 바로 실행되고, 아니라면 셸은 자식 프로세스를 만들고 자식 프로세스가 명령을 실행하도록 한다. 이때 부모인 셸은 `대기 상태`가 되며, 자식 프로세스가 실행을 종료하면 셸의 `대기 상태`가 해제된다.

#### 프로그래밍 기능
셸의 프로그래밍 기능을 이용하면 여러 명령을 사용하여 반복적으로 수행하는 작업을 하나의 프로그램으로 만들 수 있다. 이렇게 작성된 셸 프로그램을 `셸 스크립트`라고 부른다.

#### 사용자 환경 설정 기능
사용자별 환경을 설정할 수 있도록 초기화 파일 기능 제공. 사용자가 로그인할 때 이 초기화 파일이 실행되어 사용자별로 특성에 맞게 초기 환경을 설정할 수 있다.
- 명령을 찾아오는 경로 설정
- 파일과 디렉터리 생성 시 적용할 기본 권한 설정
- 다양한 환경변수 설정

---

## Shell의 종류

#### 본셸(sh)
최초의 셸로, 대부분 유닉스 기반 운영체제에서 사용되다가 현재는 배시셸이나 콘셸로 심볼릭 링크가 되어있다. 
(CentOS에서 본셸의 경로를 확인해보면 배시셸과 심볼릭 링크로 연결되어 있다.)
```sh
ls -l /bin/sh
lrwxrwxrwx. 1 root root 4 .... /bin/sh -> bash
```

#### C셸(csh)
본셸의 기능을 확장한 것으로, 본셸에는 없던 앨리어스나 히스토리 같은 사용자 편의 기능 포함.
처리 속도가 느린 단점.

#### 콘셸(ksh)
C셸과 달리 본셸과의 호환성을 유지할 뿐 아니라 히스토리, 앨리어스 등 C셸의 특징도 모두 제공하면서 처리 속도도 빠르다는 장점이 있다. CentOS에서 콘셸을 사용하기 위해서는 별도로 설치해야 한다.

#### 배시셸(bash)
배시셸은 GPL을 따르는 공개 소프트웨어로서 리눅스의 기본 셸로 제공되고 있다.
배시셸의 명령인 bash는 Bourne Again Shell의 약자로 본셸을 업그레이드 했음을 의미한다.

---

## 셸 지정 및 변경

![](images/linux/chsh.png)

시스템에 저장된 사용자 정보를 확인하면 현재 사용 중인 셸의 종류를 알 수 있다. 사용자 정보를 가지고 있는 파일 `/etc/passwd`에서 특정 사용자의 정보를 `grep` 명령어를 통해 확인 가능하다. 

### chsh
- 사용자 로그인 셸을 변경한다
- 현재 바꿀 수 있는 셸의 종류는 `/etc/shells` 파일에 지정되어 있다
- chsh \[옵션\] \[사용자명\]
- 옵션
	- -s {shell}: 지정하는 셸(절대 경로)로 `로그인 셸`을 바꾼다.
	- -l: `/etc/shells` 파일에 지정된 셸을 출력한다

---

## 입출력 방향 변경

#### 파일 디스크립터(file descriptor)
리눅스에서는 `장치도 파일`로 관리한다. 셸은 작업 중 필요한 파일에 일련번호를 붙여 관리하며 이를 `파일 디스크립터`라고 한다.

#### 표준 입출력 장치의 파일 디스크립터
- stdin(0): 표준 입력 -> 키보드
- stdout(1): 표준 출력 -> 모니터
- stderr(2): 표준 오류 -> 모니터

#### 출력 리다이렉션 
- `명령 1> 파일명` 또는 `명령 > 파일명`
	- 지정한 파일명이 없으면 파일을 생성하고, 존재하면 파일 내용이 덮어쓰기
	- 지정한 파일을 1번 파일(stdout)로 간주하겠다는 의미
	- 즉, 표준 출력이 파일로 바뀌는 것을 의미 (1은 생략 가능)
- `명령 >> 파일명`
	- 지정한 파일명이 없으면 파일을 생성하고, 존재하면 파일의 끝에 내용 추가

#### 오류 리다이렉션
- `명령 2> 파일명`
	- 표준 출력과 표준 오류는 다르게 관리되고 있기 때문에 오류 메세지를 저장하기 위해 지정


**표준 출력과 표준 오류를 한번에 리다이렉션하기**
```bash
ls . /abc > ls.out 2> ls.err
```

**표준 출력과 표준 오류를 한 파일로 리다이렉션하기**
```bash
ls . /abc > ls.out 2>&1
```

#### 입력 리다이렉션
- `명령 0< 파일명` 또는 `명령 < 파일명`
	- 표준 입력 장치 파일을 리다이렉션하는 기능
	- `cat 파일명` 명령어는 `<`를 생략한 것
		- {파일명} 파일을 읽어들여 표준 출력


---

## 배시셸 환경 설정
셸이 사용하는 변수에는 `셸 변수`와 `환경 변수`가 있다. `셸 변수`는 현재 셸에서만 사용이 가능하고 서브 셸로는 전달되지 않는 해당 셸의 `지역 변수`이고, `환경 변수`는 현재 셸뿐만 아니라 서브 셸로도 전달되는 `전역 변수`이다.

### 주요 셸 환경 변수
- `HISTSIZE`: 히스토리 저장 크기
- `HOME`: 사용자 홈 디렉토리의 절대 경로
- `LANG`: 사용하는 언어
- `LOGNAME`: 사용자 계정 이름
- `PATH`: 명령을 탐색할 경로
- `PWD`: 작업 디렉터리의 절대 경로
- `SHELL`: 로그인 셸

### 변수 관련 명령어

#### 전체 변수 출력하기
- `set`: 셸 변수와 환경 변수를 모두 출력, 변수뿐만 아니라 함수로 정의된 것들도 출력
- `env`: 환경 변수만 출력

#### 변수 설정하기
- 셸 변수 정의(`변수명=문자열`) 
- 환경 변수 정의
	- 먼저 셸 변수를 정의하고, `export` 명령을 사용하여 환경 변수로 전환
	- 옵션 -n: 환경 변수를 셸 변수로 변경
	- `export`와 셸 변수 정의를 같이하면 한번에 환경 변수 설정 가능
- 변수 해제
	- `unset` 명령어를 통해 변수 해제 가능
	- 환경 변수와 셸 변수에서 모두 해제된다

```bash
SOME=test          // 셸 변수 정의
set | grep SOME    // 셸 변수에서 SOME 검색 (결과 O)
env | grep SOME    // 환경 변수에서 SOME 검색 (결과 X)

export SOME        // SOME을 환경 변수로
set | grep SOME    // 환경 변수에서 SOME 검색 (결과 O)
env | grep SOME    // 환경 변수에서 SOME 검색 (결과 O)

export -n SOME     // 환경 변수를 셸 변수로 전환
set | grep SOME    // 결과 O
env | grep SOME    // 결과 X

unset SOME         // 변수 해제
```


### 앨리어스와 히스토리
본셸에는 존재하지 않는 기능(앨리어스, 히스토리), c셸에서 처음 등장하여 이후 콘셸과 배시셸에서 모두 제공하는 기능이다. `앨리어스`는 복잡한 명령을 짧은 별명으로 사용할 수 있게 해주고, `히스토리`는 앞에서 입력했던 명령을 다시 불러서 사용하는 것이다.

#### 앨리어스
- 기존 명령을 대신하여 다른 이름을 붙일 수 있는 기능
- `alias`: 현재 설정된 별칭 목록 출력
- `alias 이름='명령'`: 앨리어스 설정
- `unalias 이름`: 앨리어스 삭제

#### 히스토리
- `history`: 이전 명령 목록 출력
- 명령 재실행하기
	- `!!`: 바로 직전에 실행한 명령 재실행
	- `!번호`: 히스토리에서 해당 번호의 명령 재실행
	- `!문자열`: 히스토리에서 해당 문자열로 시작하는 마지막 명령 재실행


### 환경 설정 파일
로그인할 때마다 설정한 앨리어스나 프롬프트 모양 등은 로그아웃 시 사라진다. 환경 설정 파일에 필요한 설정을 저장해두면 로그아웃을 해도 기능을 유지할 수 있다. 
`환경 설정 파일`은 사용자가 로그인할 때마다 자동으로 실행되는 명령을 저장해놓은 파일로 `시스템 환경 설정 파일`과 `사용자 환경 설정 파일`이 있으며, 셸마다 다른 이름의 파일을 사용한다.
`환경 설정 파일`은 주로 사용자가 로그인할 때 실행되어 사용자 환경을 초기화하므로 `초기화 파일`이라고도 한다.

#### 시스템 환경 설정 파일
- 시스템을 사용하는 전체 사용자의 공통 환경을 설정하는 파일
- 일반 사용자가 수정할 수 없고, 시스템 관리자가 관리
- `/etc/profile`, `/etc/bashrc`: 일관성 있는 관리를 위해 수정하지 않는다
- 대신 시스템별로 환경을 다르게 구성하고자 하면 `/etc/profile.d` 아래 `.sh` 파일 추가

##### `/etc/profile`
- 시스템 공통으로 적용되는 환경 변수 설정(PATH, USER, LOGNAME, HOSTNAME 등..)
- 기본 접근 권한 설정
- `/etc/profile.d/*.sh`를 실행

##### `/etc/bashrc`
- 시스템 공통으로 적용되는 함수와 앨리어스 설정
- 기본 프롬프트 설정
- 서브 셸을 위한 명령 경로 및 기본 접근 권한 설정

##### `/etc/profile.d/*.sh`
- 언어나 명령별로 각각 필요한 환경 설정
- 필요시 설정 파일 추가

#### 사용자 환경 설정 파일
각 사용자의 홈 디렉터리에 숨김 파일로 존재하며, 사용자가 내용을 수정하고 관리할 수 있다.
사용자 환경 설정 파일은 로그인 후 시스템 환경 설정 파일이 실행된 이후 실행되어 사용자별 환경을 설정한다.

##### `~/.bash_profile`
- `.bashrc` 파일이 있으면 실행
- 경로 추가 등 사용자가 정의하는 환경 설정 파일

##### `~/.bashrc`
- `/etc/bashrc` 파일이 있으면 실행
- 사용자가 정의하는 앨리어스나 함수 등을 설정

##### `~/.bash_logout`
- 로그아웃 시 실행할 필요가 있는 함수 등을 설정


#### 환경 설정 파일 즉시 적용
`.` 명령이나 `source` 명령을 통해 변경된 환경 설정 파일을 실행하여 재로그인 없이 변경 사항을 적용할 수 있다.

```bash
vi .bashrc     // 맨 아래에 alias ls='ls -F' 추가
source .bashrc 또는 . .bashrc
ls
```

















